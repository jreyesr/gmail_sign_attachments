# Automatic Attachment Signatures for Gmail

This Chrome extension automatically adds digital signatures to email attachments on the form of text files.

The use of digital signatures on attachments *should* guarantee the provenance of files: if a file is alleged to have been generated by the email's owner, it should have a valid digital signature file to accompany it. If a file is alleged to come from the email's owner but does NOT have a signature, it should be considered of completely unknown provenance and treated accordingly. In other words, only files with a VALID signature are to be trusted as the True Word of the email account's owner.

The extension was developed on Google Chrome, but it may also work on other Chromium-based browsers. It has been (very lightly!) tested on Brave. No tests have been performed on Edge. Use at your own risk (which you should do, anyways, since this extension accesses your Gmail account and could, in theory, read, alter, intercept and copy any and all messages).

## Installation and use

The extension is provided as an unpacked Chrome extension. I currently have no plans to package it and distribute it on the Chrome Web Store.

To use the extension, therefore, the following steps are required:
1. Clone or download the repository, or at least the `extension` folder.
1. Configure the extension:
    1. Copy the `extension/credentials.js.sample` file to `extension/credentials.js`.
    1. Edit `extension/credentials.js` and fill all fields with your own data. `INBOXSDK_APP_ID` should be generated on InboxSDK's page (the URL is on the `credentials.js` file).
1. Open Chrome/Brave, open the Extensions tab, toggle Developer Mode on (there should be a toggle switch somewhere in the window, or see [here](https://developer.chrome.com/docs/extensions/mv2/getstarted/#manifest) for screenshots)
1. Click the Load Unpacked button, browse to the `extension` folder and select it.
1. The Options page for the newly installed extension should appear. Configure the extension to your liking:
  * The Verification webpage URL should be set to the URL where the companion verifier webpage is hosted (it will appear on email footers and on every signature file). See below for more details on the verifier.
  * Choose a file containing a valid ECDSA P-521 private key, encoded as PEM, for the Private key file field. This private key will be used to generate the signatures, and its corresponding public key should be used to verify them.
1. Open or reload Gmail.
1. Click the New Message button or Reply to a message.
1. Check that a blue "Sign & Send" button appears near the normal Send button.

You're done!

From now on, every time you want to send an email with attachments, click the new "Sign & Send" button instead of the normal Send button. The extension will compute digital signatures for all attachments and add them as new attachments, with the same name as the originals plus a `.signature` extension. These signatures can be verified with the aid of a companion webpage (see below). The extension will also add a footer to your message, explaining what are the new attachments for, and a link to the verification page. This footer is intended for the email recipient.

## Companion verification webpage

The signatures are useless if the email recipients don't verify them. This is the job of the companion webpage, which is contained on the `docs` folder (just because Github Pages wants to serve files located either at the root of the repository or on a `docs` directory. This webpage should prompt the user to upload a file and its signature, verify the signature against the file using a (currently hard-coded) public key, and show the user a big PASS/FAIL message. The public key can be safely hardcoded, because it's... well... public.

My own implementation is hosted on Github Pages, since it comes for free with the repo! The verification webpage is extremely simple: a single HTML file with some JS. Therefore, it should be hostable virtually anywhere.

Before deployment, you should edit `docs/credentials.js` to contain your own public key. The one that is currently included is useless without the private key, which I will NOT commit to the repo :)

## Cryptography (safely skippable if uninterested/inexperienced)

### Threat model
TODO

### Algorithms
TODO

### Assumptions
TODO
